name: verify

on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Fetch release assets (direct links)
        shell: pwsh
        run: |
          $base = "https://github.com/Duchrau/RIS_K0_release/releases/latest/download"
          Invoke-WebRequest -Uri "$base/RIS_K0_provenanced.zip" -OutFile "RIS_K0_provenanced.zip"
          Invoke-WebRequest -Uri "$base/RIS_K0_provenanced.zip.sha256" -OutFile "RIS_K0_provenanced.zip.sha256"
          Get-ChildItem -Name
      - name: Verify
        shell: pwsh
        run: ./verify_all.ps1

  ubuntu:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install deps
        run: sudo apt-get update && sudo apt-get install -y jq unzip openssh-client coreutils curl
      - name: Fetch release assets (direct links)
        run: |
          base="https://github.com/Duchrau/RIS_K0_release/releases/latest/download"
          curl -sSL "$base/RIS_K0_provenanced.zip" -o RIS_K0_provenanced.zip
          curl -sSL "$base/RIS_K0_provenanced.zip.sha256" -o RIS_K0_provenanced.zip.sha256
          ls -la
      - name: Verify
        run: sh ./verify_all.sh
