name: verify
on:
  push:
  pull_request:
  workflow_dispatch:

jobs:
  windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Tool versions
        shell: pwsh
        run: |
          System.Management.Automation.PSVersionHashTable.PSVersion.ToString()
          ssh -V
          Get-Command ssh-keygen | Format-List *
      - name: Fetch release assets (pinned)
        shell: pwsh
        run: |
          \ = "https://github.com/Duchrau/RIS_K0_release/releases/download/k0-archive-locked-2025-11-21"
          Invoke-WebRequest -Uri "\/RIS_K0_provenanced.zip" -OutFile "RIS_K0_provenanced.zip"
          Invoke-WebRequest -Uri "\/RIS_K0_provenanced.zip.sha256" -OutFile "RIS_K0_provenanced.zip.sha256"
          Get-ChildItem -Name | Sort-Object
          Get-FileHash .\RIS_K0_provenanced.zip -Algorithm SHA256
          Get-Content .\RIS_K0_provenanced.zip.sha256 -Raw
      - name: Verify
        shell: pwsh
        run: ./verify_all.ps1

  ubuntu:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Tool versions
        run: |
          uname -a
          bash --version | head -n1
          ssh -V || true
      - name: Install deps
        run: sudo apt-get update && sudo apt-get install -y jq unzip openssh-client coreutils curl
      - name: Fetch release assets (pinned)
        run: |
          base="https://github.com/Duchrau/RIS_K0_release/releases/download/k0-archive-locked-2025-11-21"
          curl -sSL "/RIS_K0_provenanced.zip" -o RIS_K0_provenanced.zip
          curl -sSL "/RIS_K0_provenanced.zip.sha256" -o RIS_K0_provenanced.zip.sha256
          ls -la
          sha256sum RIS_K0_provenanced.zip
          cat RIS_K0_provenanced.zip.sha256
      - name: Verify
        run: sh ./verify_all.sh
